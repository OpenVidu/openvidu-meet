<div class="ov-page-container ov-mb-xxl">
	<div class="page-header">
		<div class="title">
			<mat-icon class="material-symbols-outlined ov-settings-icon">settings</mat-icon>
			<h1>Visual Customization</h1>
		</div>
		<p class="subtitle">Personalize the visual appearance of your video conference rooms to reflect your organization's brand and style.</p>
	</div>

	@if (isLoading()) {
		<div class="ov-page-loading">
			<div class="loading-content">
				<div class="loading-header">
					<div class="loading-title">
						<mat-icon class="ov-settings-icon loading-icon">settings</mat-icon>
						<h1>Loading visual settings</h1>
					</div>
					<p class="loading-subtitle">We're preparing your customization options...</p>
				</div>

				<div class="loading-spinner-container">
					<mat-spinner diameter="48"></mat-spinner>
				</div>
			</div>
		</div>
	} @else {
		<div class="page-content">
			<!-- Theme Configuration Section -->
			<mat-card class="section-card theme-config-card">
				<mat-card-header>
					<div mat-card-avatar>
						<mat-icon class="section-icon">palette</mat-icon>
					</div>
					<mat-card-title>Visual Theme</mat-card-title>
					<mat-card-subtitle>Create a custom theme that represents your brand and style</mat-card-subtitle>
				</mat-card-header>

				<mat-card-content class="ov-mt-sm">
					<form [formGroup]="appearanceForm" class="theme-form">
						<!-- Enable/Disable Toggle -->
						<h4 class="section-title">Custom Theme</h4>
						<div class="theme-toggle ov-mt-xs">
							<span>Use my own visual design</span>
							<mat-slide-toggle
								formControlName="enabled"
								[matTooltip]="!isThemeEnabled ? 'Enable this option to customize the colors and appearance of your room' : ''"
								[matTooltipDisabled]="isThemeEnabled"
							></mat-slide-toggle>
						</div>

						<!-- Theme Configuration Form -->
						@if (isThemeEnabled) {
							<!-- Base theme (light / dark) -->
							<div class="theme-section">
								<h4 class="section-title">Background Style</h4>
								<p class="section-description ov-mt-xs">
									Choose whether you prefer a light or dark background as the starting point for your customization.
								</p>
								<mat-form-field appearance="outline" class="full-width">
									<mat-label>Background style</mat-label>
									<mat-select formControlName="baseTheme">
										@for (theme of baseThemeOptions; track theme) {
											<mat-option [value]="theme">
												{{ theme.charAt(0).toUpperCase() + theme.slice(1).toLowerCase() }}
											</mat-option>
										}
									</mat-select>
									@if (appearanceForm.get('baseTheme')?.hasError('required')) {
										<mat-error>Please select a background style</mat-error>
									}
								</mat-form-field>
							</div>

							<!-- Color Pickers -->
							<div class="theme-section">
								<h4 class="section-title">Color Customization</h4>
								<p class="section-description ov-mt-xs">
									Click on any color to change it and adapt it to your brand or preferences.
								</p>
								<div class="color-picker-grid ov-mt-md">
									@for (colorConfig of colorFields; track colorConfig.key) {
										<div class="color-picker-item" (click)="focusColorInput(colorConfig.key)">
											<span class="color-label">{{ colorConfig.label }}</span>
											<div class="color-circle-wrapper">
												<input
													[id]="colorConfig.key"
													type="color"
													[formControlName]="colorConfig.key"
													[value]="getColorValue(colorConfig.key)"
													class="color-input"
												/>
												<div
													class="color-circle"
													[style.background-color]="getColorValue(colorConfig.key)"
													[class.has-custom-color]="hasCustomColor(colorConfig.key)"
												></div>
											</div>
										</div>
									}
								</div>
							</div>
						}
					</form>
				</mat-card-content>

				@if (isThemeEnabled) {
					<!-- Action Buttons -->
					<mat-card-actions>
						<button
							mat-button
							class="primary-button"
							(click)="onSaveAppearanceConfig()"
							[disabled]="appearanceForm.invalid || !hasChanges()"
						>
							<mat-icon>save</mat-icon>
							Save Changes
						</button>
						<button mat-stroked-button (click)="onResetForm()" [disabled]="!hasChanges()">
							<mat-icon>undo</mat-icon>
							Reset Changes
						</button>
					</mat-card-actions>
				}
			</mat-card>
		</div>
	}
</div>
