@if (isLoading) {
	@if (showLoadingSpinner) {
		<!-- Enhanced Loading State with delay -->
		<div class="loading-container">
			<div class="loading-content">
				<div class="loading-header">
					<div class="loading-title">
						<mat-icon class="ov-room-icon loading-icon"> video_chat </mat-icon>
						<h1>Loading Rooms</h1>
					</div>
					<p class="loading-subtitle">Please wait while we fetch your rooms...</p>
				</div>

				<div class="loading-spinner-container">
					<mat-spinner diameter="48"></mat-spinner>
				</div>
			</div>
		</div>
	}
} @else if (isInRoomForm()) {
	<!-- Edit and create Room view  -->
	<div>
		<router-outlet></router-outlet>
	</div>
} @else {
	<div class="rooms-container ov-mb-xxl">
		<div class="rooms-header">
			<div class="title">
				<mat-icon class="ov-room-icon"> video_chat </mat-icon>
				<h1>Rooms</h1>
			</div>
			<p class="subtitle">Manage your rooms, create new ones, and configure settings for your meetings.</p>
		</div>

		<div class="rooms-content">
			<!-- Search and Filter Bar -->
			@if (createdRooms.length > 0) {
				<!-- Actions Bar -->
				<div class="rooms-actions">
					<div class="actions-left">
						<div class="search-bar">
							<mat-form-field appearance="outline" class="search-field">
								<mat-label>Search rooms</mat-label>
								<input
									matInput
									[value]="searchTerm"
									(input)="applyFilter($event)"
									placeholder="Search by prefix or status..."
									autocomplete="off"
								/>
								<mat-icon matPrefix>search</mat-icon>
								@if (searchTerm) {
									<button matSuffix mat-icon-button (click)="clearFilter()" matTooltip="Clear search">
										<mat-icon>clear</mat-icon>
									</button>
								}
							</mat-form-field>
						</div>
					</div>

					<div class="actions-right">
						<button
							mat-icon-button
							matTooltip="Refresh rooms"
							(click)="refreshRooms()"
							[disabled]="isLoading"
							class="refresh-btn"
						>
							<mat-icon>refresh</mat-icon>
						</button>

						<div class="rooms-stats">
							<button mat-raised-button color="primary" (click)="createRoom()" class="create-room-btn">
								<mat-icon>add</mat-icon>
								Create New Room
							</button>
						</div>
					</div>
				</div>

				<!-- Rooms Table -->
				<div class="rooms-table-container">
					<!-- Loading Spinner -->
					@if (isLoading) {
						<div class="loading-overlay">
							<mat-spinner diameter="40"></mat-spinner>
						</div>
					}

					<!-- No Results Message -->
					@if (!isLoading && dataSource.filteredData.length === 0 && searchTerm) {
						<div class="no-results-message">
							<mat-icon class="no-results-icon">search_off</mat-icon>
							<h4>No rooms found</h4>
							<p>No rooms match your search criteria "{{ searchTerm }}"</p>
							<button mat-stroked-button (click)="clearFilter()">
								<mat-icon>clear</mat-icon>
								Clear search
							</button>
						</div>
					}

					<!-- Table View -->
					<div
						class="table-wrapper desktop-view"
						[style.display]="dataSource.filteredData.length === 0 && searchTerm ? 'none' : 'block'"
					>
						<table mat-table [dataSource]="dataSource" matSort class="rooms-table">
							<ng-container matColumnDef="roomName">
								<th mat-header-cell *matHeaderCellDef mat-sort-header class="room-name-header">
									<div class="header-content">
										<span>Room ID</span>
									</div>
								</th>
								<td mat-cell *matCellDef="let room" class="room-name-cell">
									<div class="room-name-content">
										<span class="room-id">{{ room.roomId }}</span>
									</div>
								</td>
							</ng-container>

							<!-- Creation Date Column -->
							<ng-container matColumnDef="creationDate">
								<th mat-header-cell *matHeaderCellDef mat-sort-header class="creation-date-header">
									<div class="header-content">
										<span>Created</span>
									</div>
								</th>
								<td mat-cell *matCellDef="let room" class="creation-date-cell">
									<div class="date-content">
										<span class="date-primary">{{ room.creationDate | date: 'MMM dd, yyyy' }}</span>
										<span class="date-secondary">{{ room.creationDate | date: 'HH:mm' }}</span>
									</div>
								</td>
							</ng-container>

							<!-- Status Column -->
							<ng-container matColumnDef="status">
								<th mat-header-cell *matHeaderCellDef mat-sort-header class="status-header">
									<div class="header-content">
										<span>Status</span>
									</div>
								</th>
								<td mat-cell *matCellDef="let room" class="status-cell">
									<div class="status-content">
										<div
											class="status-badge"
											[ngClass]="{
												'status-active': !room.markedForDeletion,
												'status-deletion': room.markedForDeletion
											}"
											matTooltip="{{
												room.markedForDeletion
													? 'Room will be deleted when last participant leaves'
													: ''
											}}"
										>
											<mat-icon class="status-icon">
												{{ room.markedForDeletion ? 'delete_outline' : 'check_circle' }}
											</mat-icon>
											<span>{{ room.markedForDeletion ? 'Inactive' : 'Active' }}</span>
										</div>
									</div>
								</td>
							</ng-container>

							<!-- Auto Deletion Column -->
							<ng-container matColumnDef="autoDeletion">
								<th mat-header-cell *matHeaderCellDef mat-sort-header class="auto-deletion-header">
									<div class="header-content">
										<span>Auto Deletion</span>
									</div>
								</th>
								<td mat-cell *matCellDef="let room" class="auto-deletion-cell">
									<div class="auto-deletion-content">
										@if (room.autoDeletionDate) {
											<div class="auto-deletion-info">
												<div class="deletion-badge" matTooltip="Scheduled for auto deletion">
													<mat-icon class="deletion-icon">auto_delete</mat-icon>
													<span>Scheduled</span>
												</div>
												@if (!room.markedForDeletion) {
													<div class="deletion-date">
														<span class="date-primary">{{
															room.autoDeletionDate | date: 'MMM dd, yyyy'
														}}</span>
														<span class="date-secondary">{{
															room.autoDeletionDate | date: 'HH:mm'
														}}</span>
													</div>
												}
											</div>
										} @else {
											<div
												class="no-auto-deletion"
												matTooltip="The room is not scheduled for auto deletion"
											>
												<mat-icon class="no-deletion-icon">close</mat-icon>
												<span>Not scheduled</span>
											</div>
										}
									</div>
								</td>
							</ng-container>

							<!-- Actions Column -->
							<ng-container matColumnDef="actions">
								<th mat-header-cell *matHeaderCellDef class="actions-header">
									<span>Actions</span>
								</th>
								<td mat-cell *matCellDef="let room" class="actions-cell">
									<div class="actions-content">
										<!-- Open room -->
										@if (room.markedForDeletion) {
											<button
												mat-icon-button
												(click)="viewRecordings(room)"
												matTooltip="View recordings"
											>
												<mat-icon class="ov-recording-icon">video_library</mat-icon>
											</button>
										} @else {
											<button
												mat-icon-button
												matTooltip="Open room"
												(click)="openRoom(room); $event.stopPropagation()"
												class="action-btn primary-action"
											>
												<mat-icon>open_in_new</mat-icon>
											</button>
											<!-- Room preferences -->
											<button
												mat-icon-button
												[matTooltip]="
													room.markedForDeletion
														? 'Room preferences cannot be modified - room is marked for deletion'
														: 'View room preferences'
												"
												(click)="viewPreferences(room); $event.stopPropagation()"
												[disabled]="room.markedForDeletion"
												class="action-btn room-preferences-btn"
											>
												<mat-icon>settings</mat-icon>
											</button>

											<!-- More Actions Menu -->
											<button
												mat-icon-button
												[matMenuTriggerFor]="actionsMenu"
												matTooltip="More actions"
												(click)="$event.stopPropagation()"
												class="action-btn"
											>
												<mat-icon>more_vert</mat-icon>
											</button>

											<mat-menu #actionsMenu="matMenu" class="actions-menu">
												<button mat-menu-item (click)="viewRecordings(room)">
													<mat-icon class="ov-recording-icon">video_library</mat-icon>
													<span>View Recordings</span>
												</button>
												<!-- <button mat-menu-item (click)="viewPreferences(room)">
												<mat-icon class="ov-settings-icon">settings</mat-icon>
												<span>Room Preferences</span>
											</button> -->
												<button
													mat-menu-item
													[disabled]="room.markedForDeletion"
													(click)="copyModeratorLink(room)"
												>
													<mat-icon>content_copy</mat-icon>
													<span>Copy Moderator Link</span>
												</button>
												<button
													mat-menu-item
													[disabled]="room.markedForDeletion"
													(click)="copyPublisherLink(room)"
												>
													<mat-icon>content_copy</mat-icon>
													<span>Copy Publisher Link</span>
												</button>
												@if (!room.markedForDeletion) {
													<mat-divider></mat-divider>
													<button
														mat-menu-item
														(click)="deleteRoom(room)"
														class="delete-action"
													>
														<mat-icon>delete</mat-icon>
														<span>Delete Room</span>
													</button>
												}
											</mat-menu>
										}
									</div>
								</td>
							</ng-container>

							<!-- Table Header and Rows -->
							<tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header"></tr>
							<tr
								mat-row
								*matRowDef="let row; columns: displayedColumns"
								class="room-row"
								(click)="!row.markedForDeletion && onRoomClicked(row)"
								[class.marked-for-deletion]="row.markedForDeletion"
								[class.clickable-row]="!row.markedForDeletion"
							></tr>
						</table>
					</div>
					<!-- Paginator -->
					<mat-paginator
						[pageSizeOptions]="[5, 10, 20, 50]"
						[pageSize]="10"
						showFirstLastButtons
						class="table-paginator"
						[style.display]="dataSource.filteredData.length === 0 && searchTerm ? 'none' : 'flex'"
					>
					</mat-paginator>
				</div>
			} @else {
				<!-- Empty State -->
				<ng-container>
					<div class="no-rooms-state">
						<div class="empty-content">
							<h3>No rooms created yet</h3>
							<p>Create your first room to start hosting meetings and manage your video conferences.</p>

							<div class="getting-started-actions">
								<button
									mat-raised-button
									color="primary"
									(click)="createRoom()"
									class="create-first-room-btn"
								>
									<mat-icon>add</mat-icon>
									Create Your First Room
								</button>
							</div>
						</div>
					</div>
				</ng-container>
			}
		</div>
	</div>
}
