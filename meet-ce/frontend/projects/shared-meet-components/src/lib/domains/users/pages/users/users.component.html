<div class="ov-page-container ov-mb-xxl">
	<div class="page-header">
		<div class="title">
			<mat-icon class="material-symbols-outlined ov-users">group</mat-icon>
			<h1>Users</h1>
		</div>
		<p class="subtitle">Manage your users, control access, and register new accounts.</p>
	</div>

	@if (isLoading()) {
		<div class="ov-page-loading">
			<div class="loading-content">
				<div class="loading-header">
					<div class="loading-title">
						<mat-icon class="ov-users-icon loading-icon">group</mat-icon>
						<h1>Loading Users</h1>
					</div>
					<p class="loading-subtitle">Please wait while we fetch registered users...</p>
				</div>

				<div class="loading-spinner-container">
					<mat-spinner diameter="48"></mat-spinner>
				</div>
			</div>
		</div>
	} @else {
		<div class="page-content">
			<!-- Users Section -->
			<mat-card class="section-card users-section">
				<mat-card-header class="users-header">
					<div mat-card-avatar class="users-avatar">
						<mat-icon class="section-icon users-icon">admin_panel_settings</mat-icon>
					</div>
					<mat-card-title class="users-title">Users</mat-card-title>
				</mat-card-header>

				<mat-card-content>
					<!-- Change Admin Password -->
					<form [formGroup]="adminCredentialsForm" (ngSubmit)="onSaveAdminCredentials()">
						<div class="form-section">
							<div class="form-field-header">
								<h3>Administrator Password</h3>
								<p class="field-description">
									Update your administrator password to keep your account secure. We recommend using a
									strong, unique password.
								</p>
							</div>

							<div class="admin-auth-form">
								<!-- User ID Field -->
								<mat-form-field subscriptSizing="dynamic" appearance="outline" class="user-id-field">
									<mat-label>Administrator User ID</mat-label>
									<input matInput type="text" formControlName="userId" placeholder="admin" />
									<mat-hint>This is your user ID to access the administration panel</mat-hint>
								</mat-form-field>

								<!-- Current Password Field -->
								<mat-form-field subscriptSizing="dynamic" appearance="outline" class="password-field">
									<mat-label>Current Password</mat-label>
									<input
										matInput
										[type]="showCurrentPassword() ? 'text' : 'password'"
										formControlName="currentPassword"
										placeholder="Enter your current password"
									/>
									<button
										mat-icon-button
										matSuffix
										type="button"
										class="input-btn"
										(click)="showCurrentPassword.set(!showCurrentPassword())"
										matTooltip="{{ showCurrentPassword() ? 'Hide password' : 'Show password' }}"
									>
										<mat-icon>{{
											showCurrentPassword() ? 'visibility_off' : 'visibility'
										}}</mat-icon>
									</button>
									<mat-hint>We need to verify your identity with your current password</mat-hint>
									@if (getCurrentPasswordError()) {
										<mat-error>{{ getCurrentPasswordError() }}</mat-error>
									}
								</mat-form-field>

								<!-- New Password Field -->
								<mat-form-field subscriptSizing="dynamic" appearance="outline" class="password-field">
									<mat-label>New Password</mat-label>
									<input
										matInput
										[type]="showNewPassword() ? 'text' : 'password'"
										formControlName="newPassword"
										placeholder="Create a strong, secure password"
									/>
									<button
										mat-icon-button
										matSuffix
										type="button"
										class="input-btn"
										(click)="showNewPassword.set(!showNewPassword())"
										matTooltip="{{ showNewPassword() ? 'Hide password' : 'Show password' }}"
									>
										<mat-icon>{{ showNewPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
									</button>
									<mat-hint
										>Minimum 5 characters. We recommend using letters, numbers, and
										symbols</mat-hint
									>
									@if (getNewPasswordError()) {
										<mat-error>{{ getNewPasswordError() }}</mat-error>
									}
								</mat-form-field>

								<!-- Confirm New Password Field -->
								<mat-form-field subscriptSizing="dynamic" appearance="outline" class="password-field">
									<mat-label>Confirm New Password</mat-label>
									<input
										matInput
										[type]="showConfirmPassword() ? 'text' : 'password'"
										formControlName="confirmPassword"
										placeholder="Type the new password again"
									/>
									<button
										mat-icon-button
										matSuffix
										type="button"
										class="input-btn"
										(click)="showConfirmPassword.set(!showConfirmPassword())"
										matTooltip="{{ showConfirmPassword() ? 'Hide password' : 'Show password' }}"
									>
										<mat-icon>{{
											showConfirmPassword() ? 'visibility_off' : 'visibility'
										}}</mat-icon>
									</button>
									<mat-hint>Must match exactly with your new password</mat-hint>
									@if (getConfirmPasswordError()) {
										<mat-error>{{ getConfirmPasswordError() }}</mat-error>
									}
								</mat-form-field>
							</div>
						</div>
					</form>
				</mat-card-content>
				<mat-card-actions>
					<button
						mat-button
						class="primary-button"
						type="submit"
						[disabled]="adminCredentialsForm.invalid"
						(click)="onSaveAdminCredentials()"
					>
						Update Administrator Password
					</button>
				</mat-card-actions>
			</mat-card>
		</div>
	}
</div>
