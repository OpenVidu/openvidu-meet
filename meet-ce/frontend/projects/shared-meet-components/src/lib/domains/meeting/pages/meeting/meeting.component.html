@if (showLobby) {
	<!-- Lobby phase (before joining meeting) -->
	@if (isLobbyReady) {
		<ov-meeting-lobby></ov-meeting-lobby>
	} @else if (!isLobbyReady) {
		<div class="prejoin-loading-container">
			<mat-spinner diameter="30"></mat-spinner>
			<p class="prejoin-loading-text">Preparing your meeting...</p>
		</div>
	} @else {
		<div class="prejoin-error-container">
			<mat-icon class="prejoin-error-icon">error_outline</mat-icon>
			<p class="prejoin-error-text">Unable to load the lobby. Please try reloading the page.</p>
		</div>
	}
} @else if (!isMeetingLeft()) {
	<ov-videoconference
		[token]="roomMemberToken()!"
		[prejoin]="true"
		[prejoinDisplayParticipantName]="false"
		[videoEnabled]="features().media.videoEnabled"
		[audioEnabled]="features().media.audioEnabled"
		[e2eeKey]="e2eeKey()"
		[toolbarRoomName]="roomName()"
		[toolbarCameraButton]="features().ui.showCamera"
		[toolbarMicrophoneButton]="features().ui.showMicrophone"
		[toolbarScreenshareButton]="features().ui.showScreenShare"
		[toolbarLeaveButton]="!features().permissions.canModerateRoom"
		[toolbarRecordingButton]="features().permissions.canRecordRoom"
		[toolbarViewRecordingsButton]="features().permissions.canRetrieveRecordings && hasRecordings()"
		[toolbarBroadcastingButton]="false"
		[toolbarChatPanelButton]="features().ui.showChat"
		[toolbarBackgroundEffectsButton]="features().ui.showBackgrounds"
		[toolbarParticipantsPanelButton]="features().ui.showParticipantList"
		[toolbarSettingsButton]="features().ui.showSettings"
		[toolbarFullscreenButton]="features().ui.showFullscreen"
		[toolbarActivitiesPanelButton]="features().ui.showRecordingPanel"
		[activitiesPanelRecordingActivity]="features().ui.showRecordingPanel"
		[recordingActivityShowControls]="{
			play: false,
			download: false,
			delete: false,
			externalView: true
		}"
		[recordingActivityStartStopRecordingButton]="features().permissions.canRecordRoom"
		[recordingActivityViewRecordingsButton]="features().permissions.canRetrieveRecordings && hasRecordings()"
		[recordingActivityShowRecordingsList]="false"
		[activitiesPanelBroadcastingActivity]="false"
		[showThemeSelector]="features().ui.showThemeSelector"
		[showDisconnectionDialog]="false"
		(onRoomCreated)="onRoomCreated($event)"
		(onParticipantConnected)="onParticipantConnected($event)"
		(onParticipantLeft)="onParticipantLeft($event)"
		(onRecordingStartRequested)="eventHandlerService.onRecordingStartRequested($event)"
		(onRecordingStopRequested)="eventHandlerService.onRecordingStopRequested($event)"
		(onViewRecordingsClicked)="onViewRecordingsClicked()"
	>
		<!-- Toolbar Leave Button (for moderators) -->
		<ng-container *ovToolbarLeaveButton>
			<ng-content select="ov-meeting-toolbar-leave-button"></ng-content>
		</ng-container>

		<!-- Toolbar Additional Buttons -->
		<div *ovToolbarAdditionalButtons>
			<ng-content select="ov-meeting-toolbar-extra-buttons"></ng-content>
		</div>

		<!-- Toolbar More Options Additional Items -->
		<ng-container *ovToolbarMoreOptionsAdditionalMenuItems>
			<ng-content select="ov-meeting-toolbar-more-options-menu"></ng-content>
		</ng-container>

		<!-- Share Link Panel After Local Participant -->
		<div *ovParticipantPanelAfterLocalParticipant>
			<ng-content select="ov-meeting-invite-panel"></ng-content>
		</div>

		<!-- Participant Panel Item Template -->
		<div *ovParticipantPanelItem="let participant">
			<ng-container
				[ngTemplateOutlet]="participantItemTemplate()"
				[ngTemplateOutletContext]="{ participant: participant, localParticipant: localParticipant() }"
			>
			</ng-container>
		</div>

		<ng-container *ovSettingsPanelGeneralAdditionalElements>
			<ng-content select="ov-meeting-settings-extensions"></ng-content>
		</ng-container>

		<!-- Custom layout component -->
		<ng-container *ovLayout>
			<ng-content select="ov-meeting-custom-layout"></ng-content>
		</ng-container>
	</ov-videoconference>
}
