@if (showLobby) {
	<!-- Lobby phase (before joining meeting) -->
	@if (isLobbyReady) {
		<ov-meeting-lobby></ov-meeting-lobby>
	} @else if (!isLobbyReady) {
		<div class="prejoin-loading-container">
			<mat-spinner diameter="30"></mat-spinner>
			<p class="prejoin-loading-text">Preparing your meeting...</p>
		</div>
	} @else {
		<div class="prejoin-error-container">
			<mat-icon class="prejoin-error-icon">error_outline</mat-icon>
			<p class="prejoin-error-text">Unable to load the lobby. Please try reloading the page.</p>
		</div>
	}
} @else {
	<ov-videoconference
		[token]="roomMemberToken()!"
		[prejoin]="true"
		[prejoinDisplayParticipantName]="false"
		[videoEnabled]="features().videoEnabled"
		[audioEnabled]="features().audioEnabled"
		[e2eeKey]="e2eeKey()"
		[toolbarRoomName]="roomName()"
		[toolbarCameraButton]="features().showCamera"
		[toolbarMicrophoneButton]="features().showMicrophone"
		[toolbarScreenshareButton]="features().showScreenShare"
		[toolbarLeaveButton]="!features().canModerateRoom"
		[toolbarRecordingButton]="features().canRecordRoom"
		[toolbarViewRecordingsButton]="features().canRetrieveRecordings && hasRecordings()"
		[toolbarBroadcastingButton]="false"
		[toolbarChatPanelButton]="features().showChat"
		[toolbarBackgroundEffectsButton]="features().showBackgrounds"
		[toolbarParticipantsPanelButton]="features().showParticipantList"
		[toolbarSettingsButton]="features().showSettings"
		[toolbarFullscreenButton]="features().showFullscreen"
		[toolbarActivitiesPanelButton]="features().showRecordingPanel"
		[activitiesPanelRecordingActivity]="features().showRecordingPanel"
		[recordingActivityShowControls]="{
			play: false,
			download: false,
			delete: false,
			externalView: true
		}"
		[recordingActivityStartStopRecordingButton]="features().canRecordRoom"
		[recordingActivityViewRecordingsButton]="features().canRetrieveRecordings && hasRecordings()"
		[recordingActivityShowRecordingsList]="false"
		[activitiesPanelBroadcastingActivity]="false"
		[showThemeSelector]="features().showThemeSelector"
		[showDisconnectionDialog]="false"
		(onRoomCreated)="onRoomCreated($event)"
		(onParticipantConnected)="eventHandlerService.onParticipantConnected($event)"
		(onParticipantLeft)="eventHandlerService.onParticipantLeft($event)"
		(onRecordingStartRequested)="eventHandlerService.onRecordingStartRequested($event)"
		(onRecordingStopRequested)="eventHandlerService.onRecordingStopRequested($event)"
		(onViewRecordingsClicked)="onViewRecordingsClicked()"
	>
		<!-- Toolbar Additional Buttons -->
		<div *ovToolbarAdditionalButtons>
			<ng-content select="ov-meeting-toolbar-buttons[slot='additional-buttons']"></ng-content>
		</div>

		<!-- Share Link Panel After Local Participant -->
		<div *ovParticipantPanelAfterLocalParticipant>
			<ng-content select="ov-meeting-share-link-panel[slot='after-local-participant']"></ng-content>
		</div>

		<!-- Participant Panel Item Template -->
		<div *ovParticipantPanelItem="let participant">
			<ng-container
				[ngTemplateOutlet]="participantPanelItemTemplate"
				[ngTemplateOutletContext]="{ participant: participant, localParticipant: localParticipant() }"
			>
			</ng-container>
		</div>

		<!-- Custom layout component -->
		<ng-container *ovLayout>
			<ng-content select="ov-meeting-layout[slot='layout']"></ng-content>
		</ng-container>
	</ov-videoconference>
}
